# Malware Analysis

## Goals of Analysis

\* Usually to provide info to respond to a network intrusion

\* Determine exactly what a particular suspect binary can do

\* How to detect the binary on the network

\* How to measure and contain its damage.

\* Once all the binaries are identified for analysis, next step is to develop signatures to detect malware infections on network. \(host-based or network-based\)

    \* \`host-based signatures\` - used to detect malicious code on victim computers.

\*\*\* files created or modified by malware

\*\*\* changes to the registry by malware

\*\*\* focuses on what malware does to a system \(not characteristics of malware itself\)

    \* \`network signatures\` - detect malicious code by monitoring network traffic.

\*\*\* Can be created without malware analysis

## Malware Analysis Techniques

\* \`Static Analysis\` - examine malware without running it.

\*\* Basic - consists of examining the exec file without viewing actual instructions

\*\* Can confirm whether a file is malicious

\*\* Provide info about how it functions

\*\* Sometimes provide information that will allow you to produce simple network signatures

\*\* Largely ineffective against sophisticated malware.

\* \`Dynamic Analysis\` - examine malware at its execution.

\*\* Involves observing the behavior on the system in order to remove the infection, produce effective signatures

## Types of Malware

\* \`Backdoor\` - malicious code that installs itself onto a computer to allow the attacker access.

\* \`Botnet\` - allows attacker access to the system, but all computers in the same botnet receive the same instructions from a single C&C server.

\* \`Downloader\` - malicious code that exists only to download other malicious code.

\*\* Commonly installed by attackers when they first gain access to a system.

\*\* Downloads and installs additional malicious code.

\* \`Information Stealing malware\` - collects information from a victim's computer and usually sends it to the attacker. e.g. /sniffers/, /keyloggers/, /password hash grabbers/.

\* \`Launcher\` - used to launch other malicious programs.

\*\* Use non-traditional techniques to launch other malware in order to ensure stealth.

\* \`Rootkit\` - designed to conceal the existence of other code. Usually paired with other malware \(e.g. backdoor\)

\* \`Scareware\` - designed to frighten an infected user into buying something. e.g. fake AV that pushes victim to buying service.

\* \`Spam-sending malware\` - infects a user's machine and then uses it to send spam.

\* \`Worm or virus\` - Malicious code that can copy itself and infect additional computers.

## Basic Static Analysis

1. Confirm maliciousness via AntiVirus scan

\* AV relies on a database of file signatures of suspicious code as well as behavioral/pattern-matching analysis \(/heuristics/\).

\* Malware writers can often slightly change the source and AV would not be able to pick up on malware.

\* Rare or specialized malware is usually not picked up due to its rarity.

1. Hashing - fingerprinting malware

\* Uniquely identify malware

\* MD5 or SHA-1 are two popular hashing algorithms used on malware signatures.

\* \`md5deep\` program \(free\) can create a hash of a malicious file.

\* Can share the hash with other analysts

\* Search hash online to see if file has been identified.

## Finding Strings

\* Searching through the strings can be a simple way to get hints about the function of a program. e.g. URLs accessed.

\* Windows-based \*Strings\* program can help analyze a binary for encoded strings. \[Strings\]\([http://bit.ly/ic4plL\),\](http://bit.ly/ic4plL%29,\)\)

\* Both ASCII and Unicode formats store characters in sequences, terminated by a \`NULL\` terminator to indicate string is complete.

![](/assets/mal-1.png)

Unicode use 2 bytes per character, a double 0x00 is the NULL terminator![](/assets/mal-2.png)

Not all binary encodings found are strings, so they can be ignored.

\* \*Windows function names normally begin with a capital letter + camel cased thereafter\*

\* DLL files contain executable code that is shared among multiple applications.

\* Most useful strings are that of \*error messages\* - give the most context of what malware potentially does.

## Packed/Obfuscated Malware

\* Malware authors make their malware as hard to analyze as possible to evade.

\* Obfuscated programs are ones whose execution the malware author has attempted to hide.

\* Packed programs are a subset of obfuscation, compressed and cannot be analyzed.

\* Legitimate programs usually contain a large amount of strings, indicating that analysis can find malicious code if it turns up with a small amount of strings.

\* \*PEiD\* -&gt; detect the type of packer or compiler employed to build an application.

